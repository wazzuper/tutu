<h1>Поиск билетов</h1>

<%= form_for @search, method: :post, url: search_path do |f| %>

  <div class="field">
    <%= f.label :first_station_id, 'Начальная станция' %>
    <%= f.collection_select :first_station_id, RailwayStation.all, :id, :title, {} %>
  </div>

  <div class="field">
    <%= f.label :last_station_id, 'Конечная станция' %>
    <%= f.collection_select :last_station_id, RailwayStation.all, :id, :title, {} %>
  </div>

  <div class="actions">
    <%= f.submit 'Поиск' %>
  </div>

  <% if @search.search_result %>
    <h2>Результат поиска</h2>
    <table>
      <thead>
        <tr>
        <th>Поезд</th>
        <th>Маршрут</th>
        <th>Время отправления</th>
        <th>Время прибытия</th>
        </tr>
      </thead>
      <tbody>
        <% @search.search_result.each do |result| %>
          <tr>
            <td><%= result.number %></td>
            <td><%= result.route.name %></td>
            <td><%= @search.find_arrival_station.arrival_time_in(result.route) %></td>
            <td><%= @search.find_departure_station.departure_time_in(result.route) %></td>
            <td>
              <%= link_to 'Купить билет', new_ticket_path(ticket: { train_id: result.id,
                                                                    first_station_id: @search.first_station_id,
                                                                    last_station_id: @search.last_station_id
                                                                    }) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% end %>